<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <template id="report_e_delivery_note_document">
        <!-- Multi-company -->
        <t t-if="o and 'company_id' in o">
            <t t-set="company" t-value="o.company_id.sudo()" />
        </t>
        <t t-if="not o or not 'company_id' in o">
            <t t-set="company" t-value="res_company" />
        </t>
        <t t-set="emission_date" t-value="o.transfer_date" />
        <t
            t-set="emission_address"
            t-value="o.journal_id.l10n_ec_emission_address_id"
        />
        <t t-set="partner" t-value="o.commercial_partner_id" />
        <t t-set="document_number" t-value="o.document_number" />
        <t t-set="document_date" t-value="o.transfer_date" />
        <div
            class="article small"
            t-att-data-oe-model="o and o._name"
            t-att-data-oe-id="o and o.id"
            t-att-data-oe-lang="o and o.env.context.get('lang')"
        >
            <t t-call="l10n_ec_delivery_note.report_e_delivery_note_document_head" />
            <t t-call="l10n_ec_delivery_note.report_e_delivery_note_document_body" />
        </div>
        <t t-call="l10n_ec_account_edi.electronic_report_page_footer" />
    </template>
    <template id="report_e_delivery_note_document_head">
        <div
            class="row"
            style="font-size: 11px; padding-top: 10px; padding-bottom: 10px; padding-right: 0px;"
        >
            <t
                t-set="style_div_company"
                t-value="'min-height: 230px; padding-left: 20px;'"
            />
            <t t-set="company_logo" t-value="company.logo" />
            <table class="table table-no-border">
                <tr>
                    <td width="50%">
                        <t t-if="company_logo">
                            <div class="oe_product_image">
                                <img
                                    t-att-src="image_data_uri(company_logo)"
                                    height="150"
                                    width="100%"
                                />
                            </div>
                            <br />
                        </t>
                        <div
                            class="div-bordered div-radius"
                            t-att-style="style_div_company"
                        >
                            <div class="text-center text-uppercase">
                                <strong t-field="company.name" />
                            </div>
                            <div
                                class="text-center"
                                t-if="company.partner_id.city and company.partner_id.country_id"
                            >
                                <span t-out="company.partner_id.city.capitalize()" />
                                -
                                <span
                                    t-out="company.partner_id.country_id.name.capitalize()"
                                />
                            </div>
                            <br />
                            <strong>Dir. Matriz:</strong>
                            <span t-field="company.partner_id.street" />
                            <t t-if="company.partner_id.phone">
                                <br />
                                <strong>Telf.:</strong>
                                <span t-field="company.partner_id.phone" />
                            </t>
                            <t t-if="company.partner_id.email">
                                <br />
                                <strong>Email:</strong>
                                <span t-field="company.partner_id.email" />
                            </t>
                            <t
                                t-if="company.partner_id.street != emission_address.street"
                            >
                                <br />
                                <strong>Dir. Sucursal:</strong>
                                <span t-out="emission_address.street" />
                                <t t-if="emission_address.phone">
                                    <br />
                                    <strong>Telf. Sucursal:</strong>
                                    <span t-field="emission_address.phone" />
                                </t>
                                <t t-if="emission_address.email">
                                    <br />
                                    <strong>Email Sucursal:</strong>
                                    <span t-field="emission_address.email" />
                                </t>
                            </t>
                            <t
                                t-set="contribuyente_especial"
                                t-value="company.l10n_ec_get_resolution_data(document_date)"
                            />
                            <t t-if="contribuyente_especial">
                                <br />
                                <strong>Contribuyente especial Nro:</strong>
                                <span t-out="contribuyente_especial" />
                            </t>
                            <br />
                            <t>
                                <strong>Obligado a llevar contabilidad:</strong>
                                <span
                                    t-out="o.env['account.edi.document']._l10n_ec_get_required_accounting(company.partner_id.property_account_position_id)"
                                />
                            </t>
                            <t t-if="company.l10n_ec_retention_agent">
                                <br />
                                <strong>Agente Retención Resolución No</strong>
                                <span t-out="company.l10n_ec_retention_agent" />
                            </t>
                            <t t-if="company.l10n_ec_get_regimen()">
                                <br />
                                <span t-out="company.l10n_ec_get_regimen()" />
                            </t>
                        </div>
                    </td>
                    <td>
                        <div class="div-bordered div-radius" style="min-height: 325px;">
                            <strong>R.U.C.:</strong>
                            <strong t-field="company.partner_id.vat" />
                            <br />
                            <br />
                            <strong t-out="'GUIA DE REMISIÓN'" />
                            <br />
                            Nº.
                            <span t-out="document_number" />
                            <br />
                            <br />
                            <strong>NÚMERO DE AUTORIZACION</strong>
                            <br />
                            <span t-field="o.l10n_ec_xml_access_key" />
                            <br />
                            <br />
                            <strong>Fecha y hora de autorización:</strong>
                            <span t-field="o.l10n_ec_authorization_date" />
                            <br />
                            <br />
                            <strong>AMBIENTE:</strong>
                            <span t-field="company.l10n_ec_type_environment" />
                            <br />
                            <br />
                            <strong>EMISION:</strong>
                            <span t-out="'Normal'" />
                            <br />
                            <br />
                            <strong>CLAVE DE ACCESO:</strong>
                            <br />
                            <div
                                class="oe_product_image text-center"
                                t-if="o.l10n_ec_xml_access_key"
                            >
                                <img
                                    class="barcode"
                                    t-att-src="'/report/barcode/?barcode_type=%s&amp;value=%s&amp;width=%s&amp;height=%s&amp;' % ('Code128', o.l10n_ec_xml_access_key, 400, 100)"
                                    alt="Clave de Acceso"
                                />
                                <br />
                                <span t-field="o.l10n_ec_xml_access_key" />
                            </div>
                            <br />
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </template>
    <template id="report_e_delivery_note_document_body">
        <div class="div-bordered small">
            <table class="table table-sm table-no-border">
                <tbody>
                    <tr>
                        <td>
                            <strong>Identification (Carrier):</strong>
                            <span t-field="o.delivery_carrier_id.vat" />
                        </td>
                        <td>
                            <strong>Company name / Names and Surnames:</strong>
                            <span t-field="o.delivery_carrier_id.name" />
                        </td>
                        <td>
                            <strong>Car plate:</strong>
                            <span t-field="o.l10n_ec_car_plate" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>Departure point:</strong>
                            <span t-esc="emission_address.street" />
                        </td>
                        <td>
                            <strong>Start date Transportation:</strong>
                            <span t-field="o.transfer_date" />
                        </td>
                        <td>
                            <strong>End date Transport:</strong>
                            <span t-field="o.delivery_date" />
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <br />
        <div class="div-bordered small">

            <table class="table table-sm table-no-border">
                <tbody>
                    <tr>
                        <td>
                            <strong>Sales slip:</strong>
                        </td>
                        <td>
                            <span
                                t-field="o.invoice_id.l10n_latam_document_type_id.report_name"
                            />
                            <span t-field="o.invoice_id.l10n_latam_document_number" />
                        </td>
                        <td>
                            <strong>Date of issue:</strong>
                            <span t-field="o.invoice_id.invoice_date" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong>Authorization number:</strong>
                        </td>
                        <td colspan="2">
                            <span t-field="o.l10n_ec_xml_access_key" />
                        </td>
                    </tr>
                    <tr name="motivo_traslado">
                        <td colspan="3">
                            <strong>Reason for Transfer:</strong>
                            <span t-field="o.motive" />
                        </td>
                    </tr>
                    <tr name="punto_llegada">
                        <td colspan="3">
                            <strong>Destination (Arrival Point):</strong>
                            <span t-esc="o.delivery_address_id.street or 'NA'" />
                        </td>
                    </tr>
                    <tr name="identification_addressee">
                        <td>
                            <strong>Identification (Recipient):</strong>
                            <span t-field="partner.vat" />
                        </td>
                        <td>
                            <strong>Company name / Names and Surnames:</strong>
                            <span t-field="partner.name" />
                        </td>
                        <td>
                            <strong>Info. Contact:</strong>
                            <span
                                t-esc="'%s %s' % (o.partner_id and (o.partner_id.phone or o.partner_id.mobile) or '', o.partner_id.name) or ''"
                            />
                        </td>
                    </tr>
                    <tr name="customs_document">
                        <td colspan="3">
                            <strong>Customs Document:</strong>
                            <span t-field="o.dau" />
                        </td>
                    </tr>
                    <tr name="establishment_code">
                        <td colspan="3">
                            <strong>Destination Establishment Code:</strong>
                            <span />
                        </td>
                    </tr>
                    <tr name="route">
                        <td colspan="3">
                            <strong>Route:</strong>
                        </td>
                    </tr>
                    <tr t-if="o.note">
                        <td colspan="3">
                            <strong>Notes:</strong>
                            <span t-field="o.note" />
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered-black">
                <thead>
                    <tr style="font-size: 10px;">
                        <th class="text-center amount-xl">Main Code</th>
                        <th class="text-center" style="width: 40%;">Description</th>
                        <th name="th_qty" class="text-center amount-xl">Quantity</th>
                        <th>UoM</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-foreach="o.delivery_line_ids" t-as="line">
                        <tr style="font-size: 9px;">
                            <td>
                                <span t-field="line.product_id.default_code" />
                            </td>
                            <td>
                                <span t-field="line.description" />
                            </td>
                            <td class="text-right">
                                <span t-field="line.product_qty" />
                            </td>
                            <td>
                                <span t-field="line.product_uom_id" />
                            </td>
                        </tr>
                    </t>
                </tbody>
            </table>
        </div>
    </template>
</odoo>
